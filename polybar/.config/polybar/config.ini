[colors]
background = #2e3440
background-alt = #3b4252
foreground = #eceff4
primary = #88c0d0
secondary = #81a1c1
alert = #b48ead
disabled = #4c566a

[bar/main]
# 修复：确保背景是 Nord 深灰而非黑色
background = ${colors.background}
foreground = ${colors.foreground}
# 修复：适配 192 DPI，增加高度防止溢出
width = 100%
height = 26pt
dpi = 192
fixed-center = true
# 增加顶部和底部边距，让 Bar 更有悬浮感 (Nerd 风格)
offset-y = 0
line-size = 3pt
line-color = ${colors.primary}
# 将偏移量（分号后的数字）从 ;2 改为 ;1 或 ;0
# 在 192 DPI 下，;0 或 ;1 通常能让文字在 36pt 的高度内完美居中
font-0 = "Inconsolata Nerd Font:size=11;1"
font-1 = "Symbols Nerd Font:size=13;1"
font-2 = "JetBrainsMono Nerd Font:size=11;1"

padding-left = 1
padding-right = 2
module-margin = 1
separator = |
separator-foreground = ${colors.disabled}

modules-left = i3 pulseaudio backlight xkeyboard
modules-center = datetime
modules-right = updates filesystem temperature memory cpu powermenu

cursor-click = pointer
wm-restack = i3
override-redirect = true

[bar/full]
# 修复：确保背景是 Nord 深灰而非黑色
background = ${colors.background}
foreground = ${colors.foreground}
# 修复：适配 192 DPI，增加高度防止溢出
width = 100%
height = 26pt
dpi = 192
fixed-center = true
# 增加顶部和底部边距，让 Bar 更有悬浮感 (Nerd 风格)
offset-y = 0
line-size = 3pt
line-color = ${colors.primary}
# 将偏移量（分号后的数字）从 ;2 改为 ;1 或 ;0
# 在 192 DPI 下，;0 或 ;1 通常能让文字在 36pt 的高度内完美居中
font-0 = "Inconsolata Nerd Font:size=11;1"
font-1 = "Symbols Nerd Font:size=13;1"
font-2 = "JetBrainsMono Nerd Font:size=11;1"

padding-left = 1
padding-right = 2
module-margin = 1
separator = |
separator-foreground = ${colors.disabled}

modules-left = systray i3 pulseaudio backlight xkeyboard
modules-center = datetime
modules-right = updates filesystem temperature memory cpu powermenu

cursor-click = pointer
wm-restack = i3
override-redirect = true

[module/i3]
type = internal/i3
; 不要在这里手动指定类似 socket-path 的变量，让 Polybar 自动寻找
pin-workspaces = true
show-urgent = true
index-sort = true
label-focused = %name% 
label-focused-foreground = ${colors.primary}
label-focused-padding = 2
label-unfocused = %name% 
label-unfocused-padding = 2
label-urgent = %name% 
label-urgent-foreground = ${colors.alert}
label-urgent-padding = 2

[module/memory]
type = internal/memory
interval = 3
format-prefix = "RAM "
format-prefix-foreground = ${colors.primary}
label = %percentage_used%%

[module/datetime]
type = custom/script
interval = 1.0
exec = echo "󰃭 $(date +'%A, %d %B')  󱑒 $(date +'%H:%M')"

# 修复：直接调用脚本，避开引号嵌套陷阱
click-left = ghostty -e sh -c "cal; read -n 1"

# 视觉修复：解决文字偏下
label = %output%
label-padding = 2
label-foreground = ${colors.primary}

[module/pulseaudio]
type = internal/pulseaudio

# 确保没有多余的空格，且拼写正确
label-volume = %percentage%%
format-volume = <ramp-volume> <label-volume>

# 样式
ramp-volume-0 = 󰕿
ramp-volume-1 = 󰖀
ramp-volume-2 = 󰕾
ramp-volume-foreground = ${colors.primary}

# 静音状态
format-muted = <label-muted>
label-muted = 󰝟
label-muted-foreground = ${colors.disabled}

click-right = pavucontrol

[module/xkeyboard]
type = internal/xkeyboard

# 彻底隐藏键盘布局 (au)，只在按下锁定键时显示文字
label-layout = 
label-layout-padding = 0

# 使用纯英文大写表示锁定状态
# 这里的样式加了背景色，让它看起来像个整齐的标签
label-indicator-on-numlock = " NUM "
label-indicator-on-capslock = " CAPS "

# 样式设置：使用 primary 颜色作为背景，背景色作为文字颜色，形成反色对比
label-indicator-padding = 1
label-indicator-margin = 1
label-indicator-background = ${colors.primary}
label-indicator-foreground = ${colors.background}

[module/backlight]
type = custom/script
# 使用 -m 模式获取数据
exec = brightnessctl -m | cut -d, -f4
# 初始间隔设短一点，提高稳定性
interval = 1

# 显式指定刷新当前模块的 hook
scroll-up = brightnessctl set +5% && polybar-msg action "#backlight.module_run"
scroll-down = brightnessctl set 5%- && polybar-msg action "#backlight.module_run"

# 样式修复
format = <label>
format-prefix = "󰃠 "
format-prefix-foreground = ${colors.primary}
label = %output%
label-padding = 1

[module/updates]
type = custom/script
exec = /home/vvlaw/scripts/pacman-update.sh
interval = 600

# 左键执行更新
click-left = /home/vvlaw/scripts/pacman-update.sh --update
# 右键通过 IPC 立即刷新该模块
click-right = polybar-msg action "#updates.exec"

format = <label>
label = %output%

[module/cpu]
type = internal/cpu
interval = 2
format-prefix = "󰍛 "
format-prefix-foreground = ${colors.primary}
label = %percentage%%

[module/filesystem]
type = internal/fs
mount-0 = /
interval = 25
label-mounted = %{F#88c0d0}󰋊%{F-} %percentage_used%%

[module/temperature]
type = internal/temperature
label = %{F#88c0d0}%{F-} %temperature-c%

[module/powermenu]
type = custom/menu
label-open = " ⏻ "
label-close = "  "
label-separator = " "
menu-0-0 = "  Power "
menu-0-0-exec = systemctl poweroff
menu-0-1 = "  Reboot "
menu-0-1-exec = systemctl reboot

[module/systray]
type = internal/tray
tray-size = 50%
; 使用你 [colors] 里的背景色，或者设置一个带透明度的颜色
format-background = ${colors.background-alt}
; 给这个背景块左右加一点留白
format-padding = 1
format-margin = 2

[settings]
screenchange-reload = true
pseudo-transparency = true

